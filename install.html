<!DOCTYPE html>
<html>
<head>
    <title>FusionOpen V25 System Installation</title>

    <!-- Bootstrap 5 CSS -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
    >
</head>

<body class="somebg-light" style="background-color: lightgrey;">
<HR>
<div align="center"><img src="./images/fusionshell25open.png" width="140px" height="140px"></div>
<HR>

<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">FusionShell Open25 - System Installation</h5>
        </div>

        <div class="card-body">

            <form id="installForm" class="row g-3">

                <!-- Webserver Selection -->
                <div class="col-md-12">
                    <label for="webserver" class="form-label fw-bold">Select Webserver</label>
                    <select id="webserver" class="form-select" required>
                        <option value="">-- Choose One --</option>
                        <option value="IIS">IIS</option>
                        <option value="Apache">Apache</option>
                        <option value="Nginx">Nginx</option>
                    </select>
                </div>

                <!-- Database Selection -->
                <div class="col-md-12">
                    <label for="database" class="form-label fw-bold">Select Database</label>
                    <select id="database" class="form-select" required>
                        <option value="">-- Choose One --</option>
                        <option value="MySQL">MySQL</option>
                        <option value="Postgres">Postgres</option>
                        <option value="SQLServer">SQLServer</option>
                        <option value="SQLite">SQLite</option>
                    </select>
                </div>

                <!-- Database Details Subcontainer -->
                <div id="dbDetails" class="col-md-12 mt-3 p-3 border rounded bg-white d-none">

                    <h5 class="fw-bold mb-3">Database Connection Details</h5>

                    <div class="row g-3">

                        <!-- IP Address -->
                        <div class="col-md-6">
                            <label for="db_ip" class="form-label">Database IP Address</label>
                            <input type="text" id="db_ip" class="form-control" placeholder="127.0.0.1">
                        </div>

                        <!-- Port -->
                        <div class="col-md-6">
                            <label for="db_port" class="form-label">Port</label>
                            <input type="text" id="db_port" class="form-control" placeholder="3306">
                        </div>

                        <!-- Admin User -->
                        <div class="col-md-6">
                            <label for="db_user" class="form-label">Admin Username</label>
                            <input type="text" id="db_user" class="form-control" placeholder="admin">
                        </div>

                        <!-- Admin Password -->
                        <div class="col-md-6">
                            <label for="db_pass" class="form-label">Admin Password</label>
                            <input type="password" id="db_pass" class="form-control" placeholder="password">
                        </div>

                    </div>
                </div>

                <!-- License Subpanel -->
                <div id="licensePanel" class="col-md-12 mt-3 p-3 border rounded bg-white">

                    <h5 class="fw-bold mb-3">License Information</h5>

                    <div class="row g-3">

                        <!-- User Count -->
                        <div class="col-md-6">
                            <label for="users" class="form-label fw-bold">Number of Users</label>
                            <select id="users" class="form-select" required>
                                <option value="">-- Choose One --</option>
                                <option value="0-10">0–10</option>
                                <option value="10-50">10–50</option>
                                <option value="50-100">50–100</option>
                            </select>
                        </div>

                        <!-- License Type -->
                        <div class="col-md-6">
                            <label for="license_type" class="form-label fw-bold">License Type</label>
                            <select id="license_type" class="form-select" required>
                                <option value="">-- Choose One --</option>
                                <option value="Educational">Educational Use</option>
                                <option value="Enterprise">Enterprise</option>
                                <option value="Grid">Grid</option>
                            </select>
                        </div>

                    </div>
                </div>

                <!-- Submit Button -->
                <div class="col-12 mt-3">
                    <button type="button" class="btn btn-success w-100" onclick="submitInstall()">
                        Save Configuration
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Auto-default ports when database changes
document.getElementById("database").addEventListener("change", function () {
    const db = this.value;
    const portField = document.getElementById("db_port");
    const dbDetails = document.getElementById("dbDetails");

    // Show the subcontainer
    dbDetails.classList.remove("d-none");

    // Default ports
    switch (db) {
        case "SQLServer":
            portField.value = "1431";
            break;
        case "MySQL":
            portField.value = "3306";
            break;
        case "Postgres":
            portField.value = "5432";
            break;
        case "SQLite":
            portField.value = "inmemory";
            portField.disabled = true;
            break;
        default:
            portField.value = "";
    }

    // Enable port editing except SQLite
    if (db !== "SQLite") {
        portField.disabled = false;
    }
});

function submitInstall() {
    const webserver = document.getElementById("webserver").value;
    const database = document.getElementById("database").value;

    const users = document.getElementById("users").value;
    const license_type = document.getElementById("license_type").value;

    const db_ip = document.getElementById("db_ip").value;
    const db_port = document.getElementById("db_port").value;
    const db_user = document.getElementById("db_user").value;
    const db_pass = document.getElementById("db_pass").value;

    if (!webserver || !database || !users || !license_type) {
        alert("Please complete all selections before continuing.");
        return;
    }

    if (!db_ip || !db_user || !db_pass) {
        alert("Please complete all database connection fields.");
        return;
    }

    alert(
        "Webserver: " + webserver +
        "\nDatabase: " + database +
        "\nUsers: " + users +
        "\nLicense Type: " + license_type +
        "\nDB IP: " + db_ip +
        "\nDB Port: " + db_port +
        "\nDB Admin: " + db_user
    );

    fetch("save_config.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            webserver,
            database,
            users,
            license_type,
            db_ip,
            db_port,
            db_user,
            db_pass
        })
    })
    .then(res => res.text())
    .then(msg => {
        alert(msg);
        window.location.href = "homepage.html";
    })
    .catch(err => {
        alert("Error saving configuration.");
        console.error(err);
    });
}
</script>

</body>
</html>
